# 🐳 Docker生产环境部署指南

## 快速部署（推荐）

### 1. 上传项目到服务器
```bash
# 使用git
git clone your-repo-url
cd downloader

# 或直接上传项目文件
```

### 2. 配置API密钥
```bash
# 复制环境变量模板
cp .env.example .env

# 编辑配置文件
nano .env
```

填入你的API密钥：
```env
RAPIDAPI_KEY=你的RapidAPI密钥
RAPIDAPI_HOST=API主机地址
```

### 3. 一键部署
```bash
# 运行部署脚本
./deploy-docker.sh
```

## 手动部署步骤

### 1. 安装Docker
```bash
curl -fsSL https://get.docker.com | sh
sudo usermod -aG docker $USER
```

### 2. 安装Docker Compose
```bash
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

### 3. 构建和启动
```bash
# 构建镜像
docker-compose build

# 启动服务
docker-compose up -d

# 查看状态
docker-compose ps
```

## 服务管理

### 常用命令
```bash
# 查看运行状态
docker-compose ps

# 查看实时日志
docker-compose logs -f

# 重启服务
docker-compose restart

# 停止服务
docker-compose down

# 重新构建并启动
docker-compose up -d --build
```

### 监控和维护
```bash
# 查看资源使用情况
docker stats douyin-downloader

# 清理无用镜像
docker image prune -f

# 查看容器详细信息
docker inspect douyin-downloader
```

## 生产环境优化

### 1. 反向代理配置（Nginx）
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

### 2. SSL证书（Let's Encrypt）
```bash
# 安装certbot
sudo apt install certbot python3-certbot-nginx

# 申请证书
sudo certbot --nginx -d your-domain.com
```

### 3. 防火墙配置
```bash
# 开放端口
sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow 3000

# 启用防火墙
sudo ufw enable
```

## 故障排除

### 1. 容器启动失败
```bash
# 查看详细日志
docker-compose logs douyin-downloader

# 检查配置
docker-compose config
```

### 2. API调用失败
- 检查 `.env` 文件中的API密钥
- 确认网络连接正常
- 查看应用日志

### 3. 端口冲突
```bash
# 查看端口占用
sudo netstat -tlnp | grep :3000

# 修改docker-compose.yml中的端口映射
```

## 安全建议

1. **定期更新**：及时更新Docker镜像和系统包
2. **监控日志**：定期检查应用和系统日志
3. **备份数据**：虽然是无状态应用，建议备份配置文件
4. **限制访问**：配置防火墙规则，限制不必要的访问

## 性能优化

1. **资源限制**：在docker-compose.yml中设置内存和CPU限制
2. **日志轮转**：已配置日志轮转，避免日志文件过大
3. **健康检查**：已配置健康检查，自动重启异常容器